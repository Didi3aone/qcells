function getData(e,a,o){$(".contloading").addClass("active");var t=$("#search-box").val(),n=$("#search-by").val(),i=0,s=[];0!=$('input[name="category[]"]:checked').length&&$('input[name="category[]"]:checked').each(function(){s.push($(this).val())}),markers=[],markers[0]=[_lat_user,_lng_user,1];var r=map.getZoom();$.ajax({type:"post",url:"/store/get-data",cache:!1,data:{lat_user:_lat_user,lng_user:_lng_user,lat:e,lng:a,distance:distance,cust_color:i,search:t,search_by:n,category:s,zoom:r},dataType:"json",success:function(e){if((2==n||3==n)&&1==search_flag&&""!=e.latitude_moved&&""!=e.longitude_moved){var a=new google.maps.LatLng(e.latitude_moved,e.longitude_moved);setlatlng(e.latitude_moved,e.longitude_moved),map.setCenter(a)}if(e.datas.length>0){var i=1;$.each(e.datas,function(e,a){a.count?markers[i]=[a.coordinate.latitude,a.coordinate.longitude,a.count]:markers[i]=[a.latitude,a.longitude,1],a.count?infoWindowContent[i]=[""]:infoWindowContent[i]=['<div class="storeinfofloat" id="addressfloat">   <span class="storepic" itemprop="photo">       <img src="'+(a.store_photo?a.store_photo:"/rsc/img/ui/store-img-placeholder.png")+'" alt="'+a.name+'" />   </span>   <a href="https://www.google.com/maps/dir/Current+Location/'+a.latitude+","+a.longitude+'" class="btn opgoogbtn" target="_blank">Navigasi ke Toko</a><br/>   <a href="/store/detail/'+a.pretty_url+'" class="btn storedetbtn">Lihat Detil Toko</a>   <div class="lead"></div>   <span class="storename storeclick" itemprop="name" onclick="javascript:storeclick(\''+a.latitude+"','"+a.longitude+"','"+a.phone+"')\">"+a.name+'</span>   <span class="store-dist">('+Number(parseFloat(a.user_distance).toFixed(2))+' km away)</span>   <span class="storecont store-add" itemprop="address">'+(a.full_address?a.full_address:a.address)+'</span>   <a href="tel:'+(a.phone?a.phone:"0")+'" class="storecont store-phone" itemprop="telephone">'+(a.phone?a.phone:"-")+'</a>   <span class="storecont store-ophours"><time itemprop="openingHours" datetime="'+(a.opening_hour?a.opening_hour:"-")+'">'+(a.opening_hour?a.opening_hour:"-")+"</time></span></div>"],i++})}else(2==n||3==n)&&($("#popup .modal-title").html("Error !!!"),2==n?$("#popup .modal-text").html('<p>Nama Toko "'+t+'" tidak di temukan.</p>'):3==n?$("#popup .modal-text").html('<p>Toko yang menjual produk "'+t+'" tidak di temukan.</p>'):$("#popup .modal-text").html("<p>Toko tidak di temukan.</p>"),$("#popup").addClass("active"));o(!0)},error:function(){$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Ada Kesalahan Sistem.</p>"),$("#popup").addClass("active")}})}function setMapOnAll(e){for(var a=0;a<data_markers.length;a++)data_markers[a].setMap(e)}function clearMarkers(){setMapOnAll(null)}function deleteMarkers(){clearMarkers(),data_markers=[]}function setlatlng(e,a){_lat=e,_lng=a}function setlatlng_user(e,a){_lat_user=e,_lng_user=a}function initialize(e,a,o){void 0===o&&(o=15);var t,n=new google.maps.LatLng(e,a);0==e&&0==a?(n=new google.maps.LatLng(-1.7364578,117.5134753),t={zoom:5,center:n,maxZoom:20}):t={zoom:o,center:n,maxZoom:20};var i=document.getElementById("gmap_object");map=new google.maps.Map(i,t),geocoder=new google.maps.Geocoder,infoWindow=new google.maps.InfoWindow,setlatlng(e,a),infobox=new InfoBox({disableAutoPan:!1,maxWidth:360,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{background:"url('/rsc/img/ui/segitiga-store.png') 116px 0px no-repeat",opacity:1,width:"365px"},closeBoxMargin:"20px 10px 2px 2px;",closeBoxURL:"/rsc/img/ui/close_store_button.png",infoBoxClearance:new google.maps.Size(1,1)}),google.maps.event.addListener(infobox,"domready",function(){flag=!0}),google.maps.event.addListener(infobox,"closeclick",function(){flag=!1}),google.maps.event.addListener(map,"dragend",function(e){1==flag&&(flag=!1)}),google.maps.event.addListener(map,"zoom_changed",function(e){1==flag&&(flag=!1),infobox&&infobox.close()}),google.maps.event.addListener(map,"idle",function(o){distance=setproximityfrommap(),e=map.getCenter().lat(),a=map.getCenter().lng(),setlatlng(e,a),search_flag=!1,0==flag&&getsearchdatas()})}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){_lat_user=e.coords.latitude,_lng_user=e.coords.longitude,google.maps.event.addDomListener(window,"load",initialize(e.coords.latitude,e.coords.longitude))},function(e){switch(google.maps.event.addDomListener(window,"load",initialize(0,0)),e.code){case e.PERMISSION_DENIED:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Fitur pencarian toko membutuhkan lokasi Anda"),$("#popup .modal-text").html("<p>Kami membutuhkan lokasi Anda untuk mencari lokasi toko yang terdekat dengan posisi Anda.</p>"),$("#popup").addClass("active");break;case e.POSITION_UNAVAILABLE:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Posisi Anda tidak ditemukan.</p>"),$("#popup").addClass("active");break;case e.TIMEOUT:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Posisi Anda tidak ditemukan.</p>"),$("#popup").addClass("active");break;case e.UNKNOWN_ERROR:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Pencarian sedang error. Coba sekali lagi.</p>"),$("#popup").addClass("active")}},{enableHighAccuracy:!0,timeout:5e3}):x.innerHTML="Geolocation is not supported by this browser."}function moveToCurrentLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){_lat_user=e.coords.latitude,_lng_user=e.coords.longitude;var a=new google.maps.LatLng(_lat_user,_lng_user);setlatlng(_lat_user,_lng_user),map.setCenter(a)},function(e){switch(e.code){case e.PERMISSION_DENIED:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Fitur pencarian toko membutuhkan lokasi Anda"),$("#popup .modal-text").html("<p>Kami membutuhkan lokasi Anda untuk mencari lokasi toko yang terdekat dengan posisi Anda.</p>"),$("#popup").addClass("active");break;case e.POSITION_UNAVAILABLE:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Posisi Anda tidak ditemukan.</p>"),$("#popup").addClass("active");break;case e.TIMEOUT:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Posisi Anda tidak ditemukan.</p>"),$("#popup").addClass("active");break;case e.UNKNOWN_ERROR:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Pencarian sedang error. Coba sekali lagi.</p>"),$("#popup").addClass("active")}},{enableHighAccuracy:!0,timeout:5e3}):x.innerHTML="Geolocation is not supported by this browser."}function clearClusters(){markerCluster.clearMarkers()}function isLocationFree(e){for(var a=0,o=lookup.length;o>a;a++)if(lookup[a][0]===e[0]&&lookup[a][1]===e[1])return!1;return!0}function getsearchdatas(){deleteMarkers(),getData(_lat,_lng,function(e){var a;new google.maps.LatLngBounds;for(i=0;i<markers.length;i++){var o=new google.maps.LatLng(markers[i][0],markers[i][1]);0==i?icon="/rsc/img/ui/pin-my.png":icon="/rsc/img/ui/pinbig.png";var t;markers[i][2]>1&&markers[i][2]<=50?(icon="/rsc/img/ui/store_pin_53.png",t=new google.maps.Point(5,32)):markers[i][2]>50&&markers[i][2]<=99?(icon="/rsc/img/ui/store_pin_56.png",t=new google.maps.Point(5,35)):markers[i][2]>99&&markers[i][2]<=999?(icon="/rsc/img/ui/store_pin_66.png",t=new google.maps.Point(9,40)):markers[i][2]>999&&markers[i][2]<=9999?(icon="/rsc/img/ui/store_pin_78.png",t=new google.maps.Point(12,45)):markers[i][2]>1e4&&(icon="/rsc/img/ui/store_pin_90.png",t=new google.maps.Point(15,50));var n="",a=new MarkerWithLabel({position:o,map:map,animation:google.maps.Animation.DROP,icon:icon,labelContent:n,labelAnchor:t});google.maps.event.addListener(a,"click",function(e,a){return function(){if(""==infoWindowContent[a][0]){map.panTo(this.getPosition());var o=map.getZoom();map.setZoom(o+2)}else infobox.setContent(infoWindowContent[a][0]),infobox.open(map,e),null!=e.getAnimation()?e.setAnimation(null):(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},700))}}(a,i)),data_markers.push(a)}$(".contloading").removeClass("active")})}function codeAddress(e,a){geocoder.geocode({address:e},function(e,o){switch(o){case google.maps.GeocoderStatus.OK:map.setCenter(e[0].geometry.location),setlatlng(e[0].geometry.location.lat(),e[0].geometry.location.lng()),a(e[0].geometry.location.lat(),e[0].geometry.location.lng());break;case google.maps.GeocoderStatus.ZERO_RESULTS:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Lokasi tidak di temukan</p>"),$("#popup").addClass("active");break;case google.maps.GeocoderStatus.OVER_QUERY_LIMIT:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Limit pencarian sudah habis.</p>"),$("#popup").addClass("active");break;case google.maps.GeocoderStatus.REQUEST_DENIED:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Pencarian di tolak.</p>"),$("#popup").addClass("active");break;case google.maps.GeocoderStatus.INVALID_REQUEST:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Pencarian tidak valid.</p>"),$("#popup").addClass("active");break;case google.maps.GeocoderStatus.UNKNOWN_ERROR:$(".contloading").removeClass("active"),$("#popup .modal-title").html("Error !!!"),$("#popup .modal-text").html("<p>Pencarian sedang error. Coba sekali lagi.</p>"),$("#popup").addClass("active")}})}function initmaps(e,a,o,t,n,i){void 0===i&&(i=15),0==e&&0==a?getLocation():(setlatlng(e,a),setlatlng_user(o,t),_search_by=n,google.maps.event.addDomListener(window,"load",initialize(e,a,i)))}function checked_function(e,a,o){$("input[class='category_"+e+"']").prop("checked",a),o(!0)}function load_checked(){$('input[name="category[]"]').each(function(){var e=$(this).attr("class");if(1==$(".p_"+e).prop("checked")&&0==this.checked&&$(".p_"+e).prop("checked",!1),1==this.checked){var a=!0;$("input[class='"+e+"']").each(function(){0==this.checked&&(a=!1)}),$(".p_"+e).prop("checked",a)}})}function storeclick(e,a,o){$("#popup .modal-title").html("Apa yang ingin Anda lakukan ?"),$("#popup .modal-text").html('<a href="tel:'+(o?o:"0")+'" class="btn storetelbtn">Hubungi Toko ini</a> <a href="https://www.google.com/maps/dir/Current+Location/'+e+","+a+'" class="btn opgoogbtn" target="_blank">Navigasi ke Toko ini</a>'),$("#popup").addClass("active")}function setproximityfrommap(){var e=map.getBounds(),a=e.getSouthWest(),o=e.getNorthEast(),t=new google.maps.LatLng(0,o.lng()),n=new google.maps.LatLng(0,a.lng()),i=new google.maps.LatLng(o.lat(),0),s=new google.maps.LatLng(a.lat(),0),r=google.maps.geometry.spherical.computeDistanceBetween(t,n),l=google.maps.geometry.spherical.computeDistanceBetween(i,s),p=l/2+r*r/(8*l);return.001*p}var geocoder,map,marker,markers=[],data_markers=[],distance,_lat,_lng,_lat_user,_lng_user,_search_by,infoWindowContent=[],flag=!1,infoWindow,infobox,search_flag=!0,x=document.getElementById("gmap_object");$("#cust_color").change(function(){getsearchdatas()}),$("#search-store").click(function(){var e=$("#search-by").val(),a=$("#search-box").val();""==a?$("#search-by").val("1"):(infobox&&infobox.close(),_search_by=e,1==e?codeAddress(a,function(e,a){getsearchdatas()}):(search_flag=!0,getsearchdatas()))}),$("#pin-location").click(function(){infobox&&infobox.close(),moveToCurrentLocation()}),$("#clear-btn").click(function(){infobox&&infobox.close(),_search_by=1,$("#search-box").val(""),$("#search-box").attr("placeholder","Masukan Nama Lokasi"),$("#search-by").val("1"),$("#premium").prop("checked",!1),$("#cust_color").prop("checked",!1),$('input[name="category[]"]').prop("checked",!1),$('input[name="parent_category[]"]').prop("checked",!1),getsearchdatas()}),$("#search-by").change(function(){var e=$(this).val();1==e?$("#search-box").attr("placeholder","Masukan Nama Lokasi"):2==e?$("#search-box").attr("placeholder","Masukan Nama Toko"):3==e?$("#search-box").attr("placeholder","Masukan Nama Produk"):$("#search-box").attr("placeholder","Masukan Nama Lokasi")}),$("#search-box").keyup(function(e){13==e.keyCode&&$("#search-store").click()}),$('input[name="parent_category[]"]').change(function(){var e=$(this).val(),a=$(this).prop("checked");checked_function(e,a,function(e){infobox&&infobox.close(),getsearchdatas()})}),$('input[name="category[]"]').click(function(){var e=$(this).attr("class");if(1==$(".p_"+e).prop("checked")&&0==this.checked&&$(".p_"+e).prop("checked",!1),1==this.checked){var a=!0;$("input[class='"+e+"']").each(function(){0==this.checked&&(a=!1)}),$(".p_"+e).prop("checked",a)}infobox&&infobox.close(),getsearchdatas()}),load_checked();